分布式电商系统技术方案（E-Commerce Platform）

## 1. 项目背景与目标

### 1.1 背景说明

本项目作为个人练手工程，旨在通过构建一个**分布式电商平台**，深入实践前后端分离、DDD 分层架构、微服务演进、中间件集成与 DevOps 等现代企业级开发技术栈。项目模拟真实业务场景，覆盖从用户认证、商品管理、下单支付到后台运维的一整套业务闭环。

### 1.2 项目目标

- 搭建一套清晰、可扩展的分布式电商系统架构；
- 实现分层架构 + DDD 领域建模的后端系统；
- 支持前后端分离、微服务拆分与容器化部署；
- 实现系统高并发、高可用、模块自治、功能可插拔；
- 完善日志、缓存、队列、中间件等非功能性能力。

------

## 2. 系统架构设计

### 2.1 分层架构（基于 DDD）

- **表现层（Web & Gateway）**：前端商城（Vue SPA）、后台管理（MVC）、API Gateway。
- **应用层（Application）**：业务流程编排，协调领域服务及外部依赖。
- **领域层（Domain）**：聚合根、实体、值对象、领域服务、领域事件等核心建模。
- **基础设施层（Infrastructure）**：集成 Redis、EF Core、RabbitMQ、ElasticSearch 等实现。
- **接口层（API）**：RESTful API 服务接口。

---

### 2.2 架构示意图

```text
                 ┌───────────────────────┐
                 │     API Gateway       │
                 │ (ECommerce.APIGateway)│
                 └─────────┬─────────────┘
                           │
       ┌───────────────────┼────────────────────┐
       │                   │                    │
   [Auth]             [Product]            [Cart]   ...... （其余服务同理）
ECommerce.Identity   ECommerce.Product   ECommerce.Cart
    .API                  .API                .API
       │                   │                    │
       ▼                   ▼                    ▼
+--------------+   +--------------+     +--------------+
| Application  |   | Application  |     | Application  |
| Controllers  |   | Controllers  |     | Controllers  |
| Domain       |   | Domain       |     | Domain       |
| Infrastructure|  | Infrastructure|    | Infrastructure|
+--------------+   +--------------+     +--------------+

     ⤷ 所有服务共享基础设施：
        ┌──────────────────────────────────────────────────────┐
        │                 infrastructure/                      │
        │ ┌──────────────────────────────────────────────────┐ │
        │ │ ECommerce.BuildingBlocks                         │ │
        │ │ ├── Authentication                               │ │
        │ │ ├── EventBus (RabbitMQ 封装)                     │ │
        │ │ ├── Logging (Serilog 等)                         │ │
        │ │ ├── Redis                                         │ │
        │ │ ├── Middlewares                                   │ │
        │ └──────────────────────────────────────────────────┘ │
        │ ┌──────────────────────────────────────────────────┐ │
        │ │ ECommerce.SharedKernel                          │ │
        │ │ ├── DTOs / Enums / Constants / Exceptions       │ │
        │ │ └── Base / Interfaces                           │ │
        │ └──────────────────────────────────────────────────┘ │
        └──────────────────────────────────────────────────────┘

     ⤷ 后台管理系统：
        ┌───────────────────────────────┐
        │ admin/ECommerce.Admin.Web     │
        │ ├── Controllers               │
        │ ├── Models                    │
        │ ├── Views                     │
        │ └── Services                  │
        └───────────────────────────────┘

     ⤷ 部署配置：
        ┌───────────────────────────────┐
        │ deployment/                   │
        │ ├── env/ (.env, docker, etc.) │
        │ └── k8s/ (YAML, Helm Charts)  │
        └───────────────────────────────┘

     ⤷ 测试工程：
        ┌────────────────────────────────────┐
        │ tests/                             │
        │ └── ECommerce.Cart.Tests/          │
        │     ├── Controllers                │
        │     ├── Services                   │
        │     └── Shared (TestBase, Mocks)   │
        └────────────────────────────────────┘

     ⤷ 持久化中间件：
        ┌────────────┐       ┌──────────────┐
        │   Redis    │       │ SQL Server xN│
        └────────────┘       └──────────────┘
                                 ▲
                           各服务独立数据库

     ⤷ 异步事件驱动：
         ┌────────────────┐
         │   RabbitMQ     │
         └────────────────┘
         (统一集成 EventBus)

```



---

## 3. 微服务拆分策略

| 服务名           | 拆分优先级 | 通信方式       | 说明                                     |
| ---------------- | ---------- | -------------- | ---------------------------------------- |
| CartService      | ⭐⭐⭐⭐       | REST + Redis   | 轻量、无状态、高访问量，适合率先拆分     |
| ProductService   | ⭐⭐⭐⭐       | REST + Redis   | 商品为核心数据，建议早期拆分、独立部署   |
| AuthService      | ⭐⭐⭐        | REST + JWT     | 与 SSO 网关关联，应尽早解耦              |
| OrderService     | ⭐⭐⭐⭐       | REST + MQ      | 订单驱动流程多，需搭配事件机制，Saga支持 |
| PaymentService   | ⭐⭐⭐        | REST + Webhook | 第三方回调多，需保证幂等性与账务一致性   |
| InventoryService | ⭐⭐⭐        | REST + MQ      | 与订单强相关，库存锁定与补偿机制需完善   |

---

## 4. 系统模块职责划分

| 模块         | 职责范围                                       |
| ------------ | ---------------------------------------------- |
| 用户认证模块 | 用户注册、登录、权限管理，OAuth 授权           |
| 商品中心模块 | 商品分类、SKU、属性管理、图片存储、搜索能力    |
| 购物车模块   | 用户跨端购物清单缓存与管理（Redis 支持）       |
| 订单模块     | 创建、取消、支付、发货、售后等订单生命周期管理 |
| 支付模块     | 模拟支付通道接入、异步回调处理、退款对账       |
| 库存模块     | 库存扣减、锁定、释放、库存预警、秒杀处理等     |
| 后台管理模块 | 商品、订单、用户、数据等统一管理系统           |
| 公共支撑模块 | 日志系统、配置中心、消息队列、缓存服务等       |

---

## 5. 中间件配置与作用

| 类型     | 技术栈           | 作用描述                             |
| -------- | ---------------- | ------------------------------------ |
| 日志系统 | Serilog + Kibana | 日志采集与可视化监控                 |
| 缓存系统 | Redis            | 商品缓存、购物车缓存、Session 支持等 |
| 消息队列 | RabbitMQ         | 实现异步通信、服务解耦、事件驱动     |
| 配置中心 | Consul / Apollo  | 动态配置管理、服务注册与发现         |
| 网关系统 | YARP / Ocelot    | 请求路由、统一认证鉴权、限流控制     |

------

## 6. 性能优化与运维保障

| 方向       | 措施                                                      |
| :--------- | :-------------------------------------------------------- |
| 缓存优化   | 热门商品、用户 Session、购物车使用 Redis 缓存             |
| 数据库优化 | 建立索引、使用视图、预研分库分表                          |
| 日志系统   | Serilog + Kibana，记录操作日志、异常日志、业务事件日志    |
| 安全加固   | API 认证鉴权、请求限流、防止 XSS / SQL 注入 / CSRF 等攻击 |
| 自动化测试 | 单元测试（xUnit）、集成测试（Postman + Newman）           |
| 持续集成   | GitHub Actions + Docker 镜像构建 + Helm 部署 K8s          |
| 容灾备份   | 自动化数据库备份，Redis 开启持久化                        |
