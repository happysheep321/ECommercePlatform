# ğŸ“Œåˆ†å¸ƒå¼ç”µå•†å¹³å°ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## 1. ç³»ç»Ÿæ¶æ„æ€»è§ˆ
### 1.1 æ¶æ„å›¾ç¤ºæ„ï¼ˆæ¼”è¿›ç¤ºæ„å›¾ï¼‰

> å•ä½“æ¶æ„ â†’ DDD åˆ†å±‚ â†’ å¾®æœåŠ¡æ¶æ„ + æ¥å…¥å±‚ + ä¸­é—´ä»¶é›†æˆ

```less
                 +-------------------+
                 |   API Gateway     |
                 +-------------------+
                          |
     +--------------------+--------------------+
     |         |           |           |        |
  [Cart]   [Order]     [Product]   [Payment]  [Inventory]
     |         |           |           |        |
     |         +-----------+-----------+--------+
     |                     |
     |               [RabbitMQ]
     |
  [Redis]  â†-- Cart å¿«å–     [SQLServer] â† å„æœåŠ¡ç‹¬åº“
```

### 1.2 ä¸‰å±‚æ¶æ„ + DDD æ¨¡å—æ‹†åˆ†

- **è¡¨ç¤ºå±‚ï¼ˆWeb APIï¼‰**ï¼šå¯¹æ¥ API Gatewayï¼Œæ‰¿è½½ RESTful æ¥å£ã€‚
- **åº”ç”¨å±‚ï¼ˆApplicationï¼‰**ï¼šå¤„ç†ä¸šåŠ¡åº”ç”¨æµç¨‹ã€æœåŠ¡ç¼–æ’ã€‚
- **é¢†åŸŸå±‚ï¼ˆDomainï¼‰**ï¼šå®ä½“ã€èšåˆæ ¹ã€é¢†åŸŸæœåŠ¡ã€å€¼å¯¹è±¡ç­‰å»ºæ¨¡ã€‚
- **åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructureï¼‰**ï¼šæ•°æ®åº“è®¿é—®ã€ç¼“å­˜ã€æ¶ˆæ¯ç­‰æŠ€æœ¯å®ç°ã€‚
- **æ”¯æ’‘å±‚ï¼ˆCommon Servicesï¼‰**ï¼šæ—¥å¿—ã€é…ç½®ã€æœåŠ¡å‘ç°ã€è®¤è¯ç½‘å…³ç­‰å…±é€šèƒ½åŠ›ã€‚

## 2. å¾®æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ

### 2.1 æ‹†åˆ†ä¼˜å…ˆçº§ä¸æŠ€æœ¯é€‰å‹

| å¾®æœåŠ¡           | æ‹†åˆ†ä¼˜å…ˆçº§ | æŠ€æœ¯é€‰å‹                                  | é€šä¿¡æ–¹å¼       | æ•°æ®æŒä¹…åŒ–         | ä¼˜åŒ–å»ºè®®                           |
| ---------------- | ---------- | ----------------------------------------- | -------------- | ------------------ | ---------------------------------- |
| CartService      | â­â­â­â­       | ASP.NET Core Web API + Redis              | REST           | Redis å†…å­˜ç¼“å­˜     | è½»é‡æœåŠ¡ï¼Œå¯å¿«é€Ÿæ‹†åˆ†ï¼Œæ— çŠ¶æ€åŒ–éƒ¨ç½² |
| ProductService   | â­â­â­â­       | ASP.NET Core Web API + EF Core + Redis    | REST           | SQL Server + Redis | å›¾ç‰‡ä½¿ç”¨ OSS/CDN æ‰˜ç®¡              |
| AuthService      | â­â­â­        | IdentityServer4 + JWT + OAuth2            | REST           | SQL Server         | æ‹†åˆ†æƒé™æ¨¡å‹ã€æ”¯æŒç¤¾äº¤ç™»å½•æ‰©å±•     |
| OrderService     | â­â­â­â­       | ASP.NET Core Web API + RabbitMQ + EF Core | REST + MQ      | SQL Server         | ä½¿ç”¨ Saga/Outbox æ¨¡å¼ä¿æŒä¸€è‡´æ€§    |
| PaymentService   | â­â­â­        | Web API + ç¬¬ä¸‰æ–¹æ”¯ä»˜ SDKï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ï¼‰  | REST + WebHook | SQL Server         | å¼•å…¥å®šæ—¶ä»»åŠ¡/é˜Ÿåˆ—åšè´¦åŠ¡æ ¸å¯¹        |
| InventoryService | â­â­â­        | ASP.NET Core Web API + EF Core            | REST + MQ      | SQL Server         | æ”¯æŒé”åº“å­˜ + è¡¥å¿é€»è¾‘ + ç§’æ€ä¼˜åŒ–   |

### 2.2 æ¨èæ‹†åˆ†é¡ºåºä¸åŸå› 

1. âœ… **CartServiceï¼ˆè´­ç‰©è½¦æœåŠ¡ï¼‰**ï¼šæ— éœ€æ•°æ®åº“ï¼Œæ˜“éƒ¨ç½²ï¼Œå‹åŠ›å¤§ï¼Œåº”ä¼˜å…ˆæ‹†ã€‚
2. âœ… **ProductServiceï¼ˆå•†å“æœåŠ¡ï¼‰**ï¼šç¼“å­˜è®¾è®¡å®Œå–„ï¼Œèšåˆç»“æ„æ¸…æ™°ã€‚
3. âœ… **AuthServiceï¼ˆç”¨æˆ·æœåŠ¡ï¼‰**ï¼šæ ¸å¿ƒç½‘å…³ä¾èµ–ï¼Œåº”å°½æ—©è§£è€¦å¹¶å®ç°å•ç‚¹ç™»å½•ã€‚
4. âœ… **OrderServiceï¼ˆè®¢å•æœåŠ¡ï¼‰**ï¼šå¤æ‚ä½†é‡è¦ï¼Œäº‹ä»¶é©±åŠ¨æ‹†åˆ†å¯å¸¦æ¥æ˜¾è‘—æ”¶ç›Šã€‚
5. âœ… **PaymentService / InventoryService**ï¼šæ‹†åˆ†éœ€ç­‰äº¤æ˜“é“¾æ¡æ­å»ºåé€æ­¥å¼•å…¥ã€‚

## 3. ç³»ç»Ÿæ¨¡å—èŒè´£åˆ’åˆ†

| æ¨¡å—åç§°         | èŒè´£èŒƒå›´                                     | ä¸»è¦ç»„ä»¶æˆ–å­æ¨¡å—                                            |
| ---------------- | -------------------------------------------- | ----------------------------------------------------------- |
| ç”¨æˆ·è®¤è¯æ¨¡å—     | ç”¨æˆ·æ³¨å†Œç™»å½•ã€èº«ä»½è®¤è¯ä¸æƒé™ç®¡ç†             | `AccountService`ã€`JWT`ã€`IdentityServer4`ã€`RBAC` æ¨¡å‹     |
| å•†å“ä¸­å¿ƒæ¨¡å—     | å•†å“ä¿¡æ¯ã€åˆ†ç±»ã€SKUã€å›¾ç‰‡æ‰˜ç®¡                | `ProductService`ã€`CategoryService`ã€`SkuService`ã€OSS æ”¯æŒ |
| è´­ç‰©è½¦ï¼è®¢å•æ¨¡å— | ç”¨æˆ·è´­ç‰©æµç¨‹ã€è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ´»åŠ¨ç­–ç•¥ç­‰   | `CartService`ã€`OrderService`ã€`PromotionService`           |
| æ”¯ä»˜æ¨¡å—         | å‘èµ·æ”¯ä»˜ã€å›è°ƒå¤„ç†ã€é€€æ¬¾ã€è´¦åŠ¡æ ¸å¯¹           | `PaymentGateway`ã€`PaymentCallbackHandler`                  |
| åº“å­˜æ¨¡å—         | å®æ—¶åº“å­˜ç®¡ç†ã€é”å®šä¸é‡Šæ”¾ã€é¢„è­¦               | `InventoryLockService`ã€`InventorySyncService`              |
| åå°ç®¡ç†æ¨¡å—     | å•†å“ã€è®¢å•ã€ç”¨æˆ·ã€æ´»åŠ¨ç­‰ç»Ÿä¸€ç®¡ç†åå°         | `AdminService`ã€`DashboardService`ã€ç»Ÿè®¡åˆ†æ                |
| æ”¯æ’‘æ¨¡å—         | å…¬å…±åŸºç¡€èƒ½åŠ›ï¼šç¼“å­˜ã€æ—¥å¿—ã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯é˜Ÿåˆ— | `Redis`ã€`Serilog`ã€`Apollo/Consul`ã€`RabbitMQ`             |

## 4. æ¶æ„å¯è§†åŒ–å›¾ï¼ˆUMLï¼‰

```mermaid
graph TD
  subgraph æ¥å…¥å±‚
    G[API Gateway]
  end

  subgraph å¾®æœåŠ¡
    U[AuthService] -->|JWT| G
    C[CartService] --> G
    P[ProductService] --> G
    O[OrderService] --> G
    A[PaymentService] --> G
    I[InventoryService] --> G
  end

  subgraph æ¶ˆæ¯ä¸ç¼“å­˜ä¸­é—´ä»¶
    MQ[RabbitMQ]
    RS[Redis]
  end

  O --> MQ
  A --> MQ
  I --> MQ
  C --> RS
  P --> RS
```

## âœ… 5. ä¸­é—´ä»¶ä¸åŸºç¡€è®¾æ–½é…ç½®

| ç±»å‹     | å·¥å…· / æŠ€æœ¯     | èŒè´£                         |
| -------- | --------------- | ---------------------------- |
| æ—¥å¿—     | Serilog + ELK   | ç»Ÿä¸€æ—¥å¿—é‡‡é›†ã€ç»“æ„åŒ–æ—¥å¿—è¾“å‡º |
| ç¼“å­˜     | Redis           | å•†å“ç¼“å­˜ã€è´­ç‰©è½¦å­˜å‚¨         |
| æ¶ˆæ¯é˜Ÿåˆ— | RabbitMQ        | å¼‚æ­¥è§£è€¦ï¼Œå¤„ç†è®¢å•/åº“å­˜æ¶ˆæ¯  |
| é…ç½®ä¸­å¿ƒ | Apollo / Consul | åŠ¨æ€é…ç½®ç®¡ç†ä¸æœåŠ¡å‘ç°       |
| ç½‘å…³     | YARP / Ocelot   | è¯·æ±‚è½¬å‘ã€è®¤è¯é‰´æƒã€é™æµ     |
| ORM      | EF Core         | æ•°æ®åº“æŒä¹…åŒ–æ“ä½œ             |
| å®‰å…¨æœºåˆ¶ | JWT / OAuth2    | Token æˆæƒã€SSO å•ç‚¹ç™»å½•     |
| æ•°æ®åº“   | SQL Server      | å„å¾®æœåŠ¡ç‹¬åº“                 |



------

## âœ… 6. é¡¹ç›®ç»“æ„è§„åˆ’ï¼ˆå»ºè®®ï¼‰

```bash
ECommercePlatform/
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ ECommerce.Admin.Web/
â”‚       â”œâ”€â”€ Controllers
â”‚       â”œâ”€â”€ Models
â”‚       â”œâ”€â”€ Services
â”‚       â”œâ”€â”€ Views

â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ env
â”‚   â””â”€â”€ k8s

â”œâ”€â”€ docs/

â”œâ”€â”€ gateway/
â”‚   â””â”€â”€ ECommerce.APIGateway/
â”‚       â”œâ”€â”€ Configs
â”‚       â”œâ”€â”€ Extensions
â”‚       â”œâ”€â”€ Middlewares

â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ ECommerce.BuildingBlocks/
â”‚       â”œâ”€â”€ Authentication
â”‚       â”œâ”€â”€ EventBus
â”‚       â”œâ”€â”€ Extensions
â”‚       â”œâ”€â”€ Logging
â”‚       â”œâ”€â”€ Middlewares
â”‚       â””â”€â”€ Redis
â”‚   â””â”€â”€ ECommerce.SharedKernel/
â”‚       â”œâ”€â”€ Base
â”‚       â”œâ”€â”€ Constants
â”‚       â”œâ”€â”€ DTOs
â”‚       â”œâ”€â”€ Enums
â”‚       â”œâ”€â”€ Exceptions
â”‚       â””â”€â”€ Interfaces

â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ cart/
â”‚   â”‚   â””â”€â”€ ECommerce.Cart.API/ 
â”‚   â”‚       â”œâ”€â”€ Application
â”‚   â”‚       â”œâ”€â”€ Controllers
â”‚   â”‚       â”œâ”€â”€ Domain
â”‚   â”‚       â””â”€â”€ Infrastructure
â”‚   â”œâ”€â”€ inventory/
â”‚   â”‚   â””â”€â”€ ECommerce.Inventory.API/
â”‚   â”‚       â”œâ”€â”€ Application
â”‚   â”‚       â”œâ”€â”€ Controllers
â”‚   â”‚       â”œâ”€â”€ Domain
â”‚   â”‚       â””â”€â”€ Infrastructure
â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â””â”€â”€ ECommerce.Order.API/
â”‚   â”‚       â”œâ”€â”€ Application
â”‚   â”‚       â”œâ”€â”€ Controllers
â”‚   â”‚       â”œâ”€â”€ Domain
â”‚   â”‚       â””â”€â”€ Infrastructure
â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â””â”€â”€ ECommerce.Payment.API/
â”‚   â”‚       â”œâ”€â”€ Application
â”‚   â”‚       â”œâ”€â”€ Controllers
â”‚   â”‚       â”œâ”€â”€ Domain
â”‚   â”‚       â””â”€â”€ Infrastructure
â”‚   â”œâ”€â”€ product/
â”‚   â”‚   â””â”€â”€ ECommerce.Product.API/
â”‚   â”‚       â”œâ”€â”€ Application
â”‚   â”‚       â”œâ”€â”€ Controllers
â”‚   â”‚       â”œâ”€â”€ Domain
â”‚   â”‚       â””â”€â”€ Infrastructure
â”‚   â””â”€â”€ identity/
â”‚       â””â”€â”€ Ecommerce.Identity.API/
â”‚           â”œâ”€â”€ Application
â”‚           â”œâ”€â”€ Controllers
â”‚           â”œâ”€â”€ Domain
â”‚           â””â”€â”€ Infrastructure

â”œâ”€â”€ tests/
â”‚   â””â”€â”€ ECommerce.Cart.Tests/
â”‚       â”œâ”€â”€ Controllers
â”‚       â”œâ”€â”€ Services
â”‚       â””â”€â”€ Shared

```
