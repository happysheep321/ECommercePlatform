# 通用组件使用指南

仅保留“如何使用”。架构理念、优势、统计等内容请查看 README 或其他文档。

## 使用方法

### 1. 网关项目配置

```csharp
using ECommerce.BuildingBlocks.Extensions;
using Serilog;

var builder = WebApplication.CreateBuilder(args);

// 使用通用网关服务配置
builder.Services.AddGatewayCommonServices(builder.Configuration);
builder.Services.AddGatewayAuthorization();

builder.Host.UseSerilog();

var app = builder.Build();

Log.Information("----------启动 Gateway 服务----------");

// 使用通用网关中间件配置
app.UseGatewayCommonMiddleware(builder.Environment);

app.Run();
```

### 2. 微服务项目配置

#### 基础微服务（如Cart、Product等）

```csharp
using ECommerce.BuildingBlocks.Extensions;
using Serilog;

var builder = WebApplication.CreateBuilder(args);

// 使用通用微服务配置
builder.Services.AddMicroserviceCommonServices(
    configuration: builder.Configuration,
    serviceName: "Cart",
    swaggerTitle: "ECommerce.Cart.API",
    enableJwtAuth: false,
    enableRedis: false
);

builder.Host.UseSerilog();

var app = builder.Build();

Log.Information("----------启动 Cart 微服务----------");

// 使用通用微服务中间件配置
app.UseMicroserviceCommonMiddleware(builder.Environment);

app.Run();
```

#### 复杂微服务（如Identity）

```csharp
using Ecommerce.Identity.API.Extensions;
using ECommerce.BuildingBlocks.Extensions;
using Serilog;

var builder = WebApplication.CreateBuilder(args);

// 一行加载 Identity 所有模块
builder.Services.AddIdentityModule(builder.Configuration, builder.Environment);

builder.Host.UseSerilog();

var app = builder.Build();

Log.Information("---------- 启动 Identity 微服务 ----------");

// 使用通用微服务中间件配置
app.UseMicroserviceCommonMiddleware(builder.Environment);

// 网关访问限制中间件
app.UseGatewayAccessControl();

app.Run();
```

### 3. 服务注册扩展方法（速查）

#### 通用微服务配置（按需开关）

```csharp
services.AddMicroserviceCommonServices(
    configuration: config,
    serviceName: "ServiceName",
    swaggerTitle: "API Title",
    enableJwtAuth: true,        // 是否启用JWT认证
    enableRedis: true,          // 是否启用Redis
    mediatRAssemblies: new[] { typeof(SomeCommand) },  // MediatR程序集
    validatorAssemblies: new[] { typeof(SomeValidator) }  // 验证器程序集
);
```

#### 网关配置（按需）

```csharp
services.AddGatewayCommonServices(configuration);
services.AddGatewayAuthorization();
```

### 4. 中间件配置（速查）

#### 微服务中间件

```csharp
app.UseMicroserviceCommonMiddleware(
    env,
    enableSwagger: true,
    enableAuthentication: true,
    enableAuthorization: true
);
```

#### 网关中间件

```csharp
app.UseGatewayCommonMiddleware(env);
```

#### 网关访问控制（仅需网关强制访问时开启）

```csharp
app.UseGatewayAccessControl();
```

> 说明：
> - 架构优势、代码统计、DDD理念等均移至 README / 其他文档，避免重复。
> - 本文仅作为“查用法”的速查表。
