# ðŸ§© åˆ†å¸ƒå¼ç”µå•†ç³»ç»Ÿé¢†åŸŸæ¨¡åž‹æ–‡æ¡£

## ä¸€ã€é¢†åŸŸæ¨¡åž‹è®¾è®¡ï¼ˆDDDèšåˆåˆ’åˆ†ï¼‰

ç³»ç»ŸåŸºäºŽé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰åŽŸåˆ™ï¼Œå°†ä¸šåŠ¡åˆ’åˆ†ä¸ºè‹¥å¹²èšåˆï¼ˆAggregateï¼‰ï¼Œæ¯ä¸ªèšåˆåŒ…å«èšåˆæ ¹åŠå…¶å­å®žä½“å’Œå€¼å¯¹è±¡ï¼Œèšåˆä¹‹é—´é€šè¿‡ä¸Šä¸‹æ–‡è¾¹ç•Œå®žçŽ°è§£è€¦ï¼Œä¸ºå¾®æœåŠ¡æž¶æž„æä¾›åŸºç¡€ã€‚

### ðŸ§ ç”¨æˆ·èšåˆï¼ˆUser Aggregateï¼‰

| å®žä½“å           | è¯´æ˜Ž                               |
| ---------------- | ---------------------------------- |
| **User**         | ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€ç™»å½•å‡­æ®ç­‰           |
| **Role**         | ç”¨æˆ·è§’è‰²ï¼ˆä¹°å®¶ã€å–å®¶ã€ç®¡ç†å‘˜ï¼‰     |
| **UserProfile**  | æ‰©å±•èµ„æ–™ï¼ˆæ˜µç§°ã€å¤´åƒã€æ³¨å†Œæ—¶é—´ç­‰ï¼‰ |
| **UserLoginLog** | ç™»å½•åŽ†å²è®°å½•ï¼Œå®‰å…¨å®¡è®¡ç”¨é€”         |
| **UserAddress**  | æ”¶è´§åœ°å€ç®¡ç†ï¼Œæ”¯æŒå¤šä¸ªåœ°å€         |

âœ… å…³ç³»è¯´æ˜Žï¼š

- ä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼ˆå¤šå¯¹å¤šï¼‰
- ä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªåœ°å€ï¼ˆUserAddressï¼‰ï¼ˆä¸€å¯¹å¤šï¼‰

------

### ðŸ›’ è´­ç‰©è½¦èšåˆï¼ˆCart Aggregateï¼‰

| å®žä½“å       | è¯´æ˜Ž                             |
| ------------ | -------------------------------- |
| **Cart**     | æ¯ä¸ªç”¨æˆ·å”¯ä¸€çš„è´­ç‰©è½¦             |
| **CartItem** | åŠ å…¥çš„å•†å“ SKUã€æ•°é‡ã€é€‰ä¸­çŠ¶æ€ç­‰ |

âœ… å…³ç³»è¯´æ˜Žï¼š

- æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªè´­ç‰©è½¦ï¼ˆä¸€å¯¹ä¸€ï¼‰
- ä¸€ä¸ªè´­ç‰©è½¦å¯åŒ…å«å¤šä¸ªè´­ç‰©è½¦é¡¹ï¼ˆCartItemï¼‰ï¼ˆä¸€å¯¹å¤šï¼‰
- æ¯ä¸ª CartItem å…³è”ä¸€ä¸ª SKUï¼ˆå¤šå¯¹ä¸€ï¼‰

------

### ðŸ“¦ å•†å“èšåˆï¼ˆProduct Aggregateï¼‰

| å®žä½“å               | è¯´æ˜Ž                                 |
| -------------------- | ------------------------------------ |
| **Product**          | å•†å“ä¸»ä¿¡æ¯ï¼ˆå¦‚â€œiPhone 15â€ï¼‰          |
| **SKU**              | é”€å”®è§„æ ¼ï¼ˆå¦‚â€œé»‘è‰² 128Gâ€ï¼‰            |
| **Category**         | å¤šçº§åˆ†ç±»ç»“æž„                         |
| **Brand**            | å“ç‰Œä¿¡æ¯ï¼ˆAppleã€å°ç±³ç­‰ï¼‰            |
| **ProductImage**     | è½®æ’­å›¾ã€ä¸»å›¾ã€è¯¦æƒ…å›¾ç­‰               |
| **ProductAttribute** | å•†å“è‡ªå®šä¹‰å±žæ€§ï¼ˆå¦‚å±å¹•å°ºå¯¸ã€é‡é‡ç­‰ï¼‰ |

âœ… å…³ç³»è¯´æ˜Žï¼š

- ä¸€ä¸ªå•†å“å±žäºŽä¸€ä¸ªåˆ†ç±»ï¼ˆå¤šå¯¹ä¸€ï¼‰
- ä¸€ä¸ªå•†å“å¯æœ‰å¤šä¸ª SKUï¼ˆä¸€å¯¹å¤šï¼‰
- SKU ä¸Žåº“å­˜èšåˆè”åŠ¨

------

### ðŸ“‘ è®¢å•èšåˆï¼ˆOrder Aggregateï¼‰

| å®žä½“å          | è¯´æ˜Ž                               |
| --------------- | ---------------------------------- |
| **Order**       | ä¸»è®¢å•è®°å½•                         |
| **OrderItem**   | å•†å“é¡¹è®°å½•                         |
| **OrderStatus** | çŠ¶æ€å€¼ï¼ˆå·²åˆ›å»ºã€å·²æ”¯ä»˜ã€å·²å‘è´§ç­‰ï¼‰ |
| **OrderLog**    | æ“ä½œè®°å½•ï¼Œå¦‚â€œæ”¯ä»˜æˆåŠŸâ€ã€â€œå‘è´§â€ç­‰   |

âœ… å…³ç³»è¯´æ˜Žï¼š

- ä¸€ä¸ªè®¢å•åŒ…å«å¤šä¸ªè®¢å•é¡¹ï¼ˆOrderItemï¼‰ï¼ˆä¸€å¯¹å¤šï¼‰
- ä¸€ä¸ªè®¢å•ç”±ä¸€ä¸ªç”¨æˆ·åˆ›å»ºï¼ˆå¤šå¯¹ä¸€ï¼‰
- ä¸€ä¸ªè®¢å•å¯¹åº”ä¸€ä¸ªæ”¶è´§åœ°å€ï¼ˆå¤šå¯¹ä¸€ï¼‰
- ä¸€ä¸ªè®¢å•æ‹¥æœ‰å¤šä¸ªçŠ¶æ€å˜æ›´è®°å½•ï¼ˆOrderLogï¼‰ï¼ˆä¸€å¯¹å¤šï¼‰

------

### ðŸ’° æ”¯ä»˜èšåˆï¼ˆPayment Aggregateï¼‰

| å®žä½“å             | è¯´æ˜Ž                                   |
| ------------------ | -------------------------------------- |
| **Payment**        | æ”¯ä»˜è¯¦æƒ…ï¼šé‡‘é¢ã€æ”¯ä»˜æ—¶é—´ã€å…³è”è®¢å•     |
| **PaymentStatus**  | æ”¯ä»˜çŠ¶æ€ï¼šæˆåŠŸã€å¤±è´¥ã€å¾…æ”¯ä»˜ã€å·²é€€æ¬¾ç­‰ |
| **RefundRecord**   | å”®åŽé€€æ¬¾è®°å½•                           |
| **PaymentChannel** | æ”¯ä»˜æ–¹å¼ï¼ˆå¦‚æ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œå¡ï¼‰     |

âœ… å…³ç³»è¯´æ˜Žï¼š

- ä¸€ç¬”æ”¯ä»˜è®°å½•å¯¹åº”ä¸€ä¸ªè®¢å•ï¼ˆå¤šå¯¹ä¸€ï¼‰
- æ¯ç¬”æ”¯ä»˜å…·å¤‡ä¸€ä¸ªçŠ¶æ€ï¼ˆå¤šå¯¹ä¸€ï¼‰

------

### ðŸ­ åº“å­˜èšåˆï¼ˆInventory Aggregateï¼‰

| å®žä½“å           | è¯´æ˜Ž                             |
| ---------------- | -------------------------------- |
| **Inventory**    | æ¯ä¸ª SKU å¯¹åº”ä¸€æ¡åº“å­˜è®°å½•        |
| **InventoryLog** | åº“å­˜å˜åŠ¨æ—¥å¿—ï¼Œå¦‚ä¸‹å•ã€å‘è´§ç­‰æ“ä½œ |

âœ… å…³ç³»è¯´æ˜Žï¼š

- æ¯ä¸ª SKU å¯¹åº”ä¸€ä¸ªåº“å­˜ï¼ˆInventoryï¼‰ï¼ˆä¸€å¯¹ä¸€ï¼‰
- ä¸€æ¡åº“å­˜è®°å½•å¯å…³è”å¤šä¸ªå˜åŠ¨æ—¥å¿—ï¼ˆInventoryLogï¼‰ï¼ˆä¸€å¯¹å¤šï¼‰

------

### ðŸ“¦ ç‰©æµèšåˆï¼ˆShipping Aggregateï¼‰

| å®žä½“å              | è¯´æ˜Ž                       |
| ------------------- | -------------------------- |
| **Shipment**        | å‘è´§è®°å½•ï¼Œå¯¹åº”è®¢å•         |
| **TrackingInfo**    | å¿«é€’å•å·ã€ç‰©æµçŠ¶æ€ã€è½¨è¿¹   |
| **ShippingCompany** | ç‰©æµæœåŠ¡å•†ï¼Œå¦‚é¡ºä¸°ã€åœ†é€šç­‰ |

------

### ðŸŒŸ è¯„ä»·èšåˆï¼ˆReview Aggregateï¼‰

| å®žä½“å          | è¯´æ˜Ž                             |
| --------------- | -------------------------------- |
| **Review**      | ç”¨æˆ·å¯¹å•†å“çš„è¯„ä»·                 |
| **ReviewReply** | å–å®¶æˆ–å®¢æœçš„è¯„è®ºå›žå¤             |
| **Rating**      | å¤šç»´è¯„åˆ†ï¼ˆå•†å“è´¨é‡ã€ç‰©æµæœåŠ¡ç­‰ï¼‰ |

------

### ðŸŽ ä¼˜æƒ åˆ¸èšåˆï¼ˆCoupon Aggregateï¼‰

| å®žä½“å         | è¯´æ˜Ž                              |
| -------------- | --------------------------------- |
| **Coupon**     | ä¼˜æƒ åˆ¸å®šä¹‰ï¼Œå¦‚æ»¡å‡ã€æ‰“æŠ˜ç­‰        |
| **CouponUser** | ç”¨æˆ·é¢†å–ä¸Žä½¿ç”¨è®°å½•                |
| **CouponRule** | ä½¿ç”¨è§„åˆ™ï¼Œå¦‚æ»¡100å¯ç”¨ã€é™æ–°ç”¨æˆ·ç­‰ |

------

### ðŸ”” æ¶ˆæ¯é€šçŸ¥èšåˆï¼ˆNotification Aggregateï¼‰

| å®žä½“å               | è¯´æ˜Ž                             |
| -------------------- | -------------------------------- |
| **Notification**     | ç³»ç»ŸæŽ¨é€æ¶ˆæ¯                     |
| **UserNotification** | ç”¨æˆ·æ”¶åˆ°çš„æ¶ˆæ¯è®°å½•ï¼ˆæ˜¯å¦å·²è¯»ç­‰ï¼‰ |

------

### ðŸ§  èšåˆæ¨¡åž‹å…¨æ™¯æ€»è§ˆè¡¨

| èšåˆåç§° | èšåˆæ ¹         | å­å®žä½“/å€¼å¯¹è±¡                          | è¯´æ˜Ž                     |
| -------- | -------------- | -------------------------------------- | ------------------------ |
| ç”¨æˆ·     | `User`         | Roleã€Profileã€LoginLogã€UserAddress   | ç”¨æˆ·ä½“ç³»ä¸Žæƒé™æŽ§åˆ¶       |
| å•†å“     | `Product`      | SKUã€Categoryã€Brandã€Attributeã€Image | å•†å“ä¸»ä¿¡æ¯ + å¤šè§„æ ¼ SKU  |
| è´­ç‰©è½¦   | `Cart`         | CartItem                               | ç”¨æˆ·ä¸´æ—¶ä¸‹å•å®¹å™¨         |
| è®¢å•     | `Order`        | OrderItemã€Addressã€OrderLogã€Status   | è®¢å•ç”Ÿå‘½å‘¨æœŸå…¨è¿‡ç¨‹       |
| æ”¯ä»˜     | `Payment`      | PaymentStatusã€Refundã€Channel         | æ”¯ä»˜è®°å½•ä¸Žå”®åŽé€€æ¬¾       |
| åº“å­˜     | `Inventory`    | InventoryLog                           | SKU åº“å­˜ç®¡ç†ä¸Žæ“ä½œæ—¥å¿—   |
| ç‰©æµ     | `Shipment`     | TrackingInfoã€ShippingCompany          | å‘è´§ä¸Žç‰©æµè·Ÿè¸ª           |
| è¯„ä»·     | `Review`       | Replyã€Rating                          | å•†å“å£ç¢‘ä¸Žç”¨æˆ·åé¦ˆ       |
| ä¼˜æƒ åˆ¸   | `Coupon`       | CouponUserã€CouponRule                 | è¥é”€å·¥å…·ä½“ç³»             |
| é€šçŸ¥     | `Notification` | UserNotification                       | è®¢å•çŠ¶æ€æŽ¨é€ã€å¹³å°æ¶ˆæ¯ç­‰ |

------

## äºŒã€ä¸Šä¸‹æ–‡è¾¹ç•Œåˆ’åˆ†ï¼ˆBounded Context & Context Mappingï¼‰

| å¾®æœåŠ¡åç§°ï¼ˆä¸Šä¸‹æ–‡ï¼‰ | èšåˆï¼ˆAggregateï¼‰                                            | ç®€è¦èŒè´£è¯´æ˜Ž                                                 |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **UserService**      | UserAggregateã€RoleAggregateã€AddressAggregate               | ç”¨æˆ·æ³¨å†Œç™»å½•ã€æƒé™åˆ†é…ã€åœ°å€ç®¡ç†ã€é€šçŸ¥è®¢é˜…ç­‰ç”¨æˆ·ç›¸å…³åŠŸèƒ½ç»Ÿä¸€å»ºæ¨¡ç®¡ç† |
| **ProductService**   | ProductAggregateã€SkuAggregateã€CategoryAggregateã€BrandAggregateã€ReviewAggregate | å•†å“å±•ç¤ºã€SKU åº“å­˜å±žæ€§ã€åˆ†ç±»ä¸Žå“ç‰Œç»´æŠ¤ã€ç”¨æˆ·è¯„ä»·å¤„ç†         |
| **CartService**      | CartAggregateã€CouponAggregate                               | ç”¨æˆ·è´­ç‰©è½¦ã€è´­ç‰©é¡¹ç®¡ç†ï¼Œä¼˜æƒ åˆ¸ä½¿ç”¨ç­–ç•¥æŽ§åˆ¶                   |
| **OrderService**     | OrderAggregateã€OrderItemAggregateã€ShipmentAggregate        | åˆ›å»ºè®¢å•ã€è®¢å•çŠ¶æ€ç®¡ç†ã€ç‰©æµä¿¡æ¯èšåˆä¸Žè·Ÿè¸ª                   |
| **PaymentService**   | PaymentAggregateã€RefundAggregateã€ChannelAggregate          | æ”¯ä»˜å‘èµ·ã€é€€æ¬¾é€»è¾‘ã€æ”¯ä»˜æ¸ é“é…ç½®ç®¡ç†                         |
| **InventoryService** | StockAggregateã€StockLogAggregate                            | SKUåº“å­˜ã€é¢„æ‰£å‡ã€å›žæ»šè¡¥å¿ç­–ç•¥                                |

------

## ä¸‰ã€ä¸Šä¸‹æ–‡ä¾èµ–å…³ç³»å›¾è°±

| ä¸Šä¸‹æ–‡åç§°           | ä¸Šæ¸¸ä¾èµ–                                     | ä¸‹æ¸¸ä¾èµ–                                       | æè¿°                                 |
| -------------------- | -------------------------------------------- | ---------------------------------------------- | ------------------------------------ |
| **UserService**      | -                                            | CartServiceï¼ˆç”¨æˆ·æ ¡éªŒï¼‰                        | æä¾›ç”¨æˆ·èº«ä»½å’Œæƒé™èƒ½åŠ›               |
| **ProductService**   | -                                            | CartServiceã€InventoryServiceã€ReviewAggregate | æä¾›å•†å“ã€SKUã€å“ç‰Œã€åˆ†ç±»æ•°æ®        |
| **CartService**      | UserServiceã€ProductServiceã€CouponAggregate | OrderService                                   | èšåˆä¸‹å•å‰çš„æ•°æ®ã€éªŒè¯ä¼˜æƒ ä¿¡æ¯       |
| **OrderService**     | CartService                                  | PaymentServiceã€InventoryService               | åˆ›å»ºè®¢å•åŽè§¦å‘æ”¯ä»˜ä¸Žåº“å­˜é€»è¾‘         |
| **PaymentService**   | OrderService                                 | InventoryServiceã€NotificationModule           | æˆåŠŸæ”¯ä»˜åŽæ‰£å‡åº“å­˜ï¼Œè§¦å‘æ¶ˆæ¯é€šçŸ¥     |
| **InventoryService** | ProductServiceã€PaymentService               | -                                              | åº“å­˜æ•°æ®ç®¡ç†ï¼Œå¤„ç†æ”¯ä»˜åŽæ‰£å‡åº“å­˜é€»è¾‘ |

> ðŸ“Œ è¡¥å……è¯´æ˜Žï¼šCouponã€Reviewã€Notification ç­‰æ˜¯æ‰©å±•æ€§å¼ºçš„èšåˆæ¨¡å—ï¼ŒåˆæœŸä½œä¸ºèšåˆå­˜åœ¨äºŽä¸»æœåŠ¡ä¸­ï¼Œæœªæ¥å¯ç‹¬ç«‹æ‹†åˆ†æˆæœåŠ¡ã€‚

------

## å››ã€ä¸Šä¸‹æ–‡è¾¹ç•Œæ˜ å°„å…³ç³»å›¾

```mermaid
graph TD
  subgraph UserContext
    UserService[UserService]
  end

  subgraph ProductContext
    ProductService[ProductService]
  end

  subgraph CartContext
    CartService[CartService]
  end

  subgraph OrderContext
    OrderService[OrderService]
  end

  subgraph PaymentContext
    PaymentService[PaymentService]
  end

  subgraph InventoryContext
    InventoryService[InventoryService]
  end

  %% ä¸Šæ¸¸ä¾èµ–
  UserService --> CartService
  ProductService --> CartService
  ProductService --> InventoryService
  ProductService --> ReviewAggregate
  CartService --> OrderService
  OrderService --> PaymentService
  PaymentService --> InventoryService
```

