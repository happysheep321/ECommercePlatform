# ✅ YARP 网关项目必备功能清单

> 🎯 **目标**：统一处理认证、权限、跨域、安全、服务注册与发现等基础能力，构建稳定、可控的微服务入口。

------

## 🔐 1. JWT 认证与权限校验（Authentication & Authorization）

- 网关统一处理 JWT Token 的校验逻辑。
- 验证失败直接拒绝请求，无需转发至下游服务。
- 可提取用户 Claims 写入 `HttpContext.User`，供后续服务使用。

------

## 🌐 2. 跨域处理（CORS）

- 网关层全局配置 CORS 策略，统一允许前端跨域请求。
- 避免每个下游服务单独处理跨域问题。

------

## ⚙️ 3. 限流与熔断机制（Resilience）

- 配置中间件实现接口访问频率限制（防刷攻击）。
- 使用熔断器（如 Polly）保护下游服务，避免级联故障。
- 支持失败自动重试策略（适用于瞬时错误）。

------

## 🕵️ 4. 日志追踪与请求审计（Logging & Tracing）

- 每个请求生成唯一 TraceId（CorrelationId），写入响应头。
- TraceId 保持在全链路日志中，支持日志聚合系统（如 ELK、Seq）。
- 网关记录请求日志、异常信息、安全校验失败等行为。

------

## 🧭 5. 服务注册与发现（Service Discovery with Consul）

- 网关自动从 **Consul** 获取可用微服务实例列表（动态地址 + 健康状态）。
- 支持服务动态上下线，YARP 路由表自动刷新（无需重启网关）。
- 各微服务在启动时将自身注册至 Consul（含健康检查路由）。
- 支持 YARP 与 Consul 的健康服务联动，确保只转发至可用实例。

------

### ✅ 微服务端需配合实现（Consul 侧）：

- 每个微服务注册时需提供唯一 `ServiceName` 和 `ServiceId`。
- 每个微服务应暴露 `/health` 健康检查接口。
- 启动时自动注册 + 停止时自动注销（通过 Sidecar 或 SDK 实现）。