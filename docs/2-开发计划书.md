# 🛒 分布式电商系统开发计划书

## 一、项目概览

本项目旨在构建一个基于 ASP.NET Core 微服务架构的分布式电商平台，采用 DDD 分层设计，具备高可用性、可扩展性、模块解耦和良好的维护性。涵盖注册登录、商品管理、购物车、下单、支付、库存等完整业务链路，支持容器化部署，集成 Redis、RabbitMQ、Elasticsearch、Serilog、IdentityServer4 等中间件。

------

## 二、系统开发任务拆解（WBS）

### 📌 阶段一：业务建模与系统架构设计

| 编号 | 任务内容                             | 输出成果                     |
| ---- | ------------------------------------ | ---------------------------- |
| 1.1  | 系统整体架构图设计                   | 架构图（Draw.io、PlantUML）  |
| 1.2  | 模块拆解与职责边界明确               | 服务划分说明文档             |
| 1.3  | DDD 建模：聚合、实体、值对象定义     | 各服务领域模型草图与设计说明 |
| 1.4  | 上下文边界与 Context Mapping         | Bounded Context 图           |
| 1.5  | 关键业务流程建模（注册、下单、发货） | 用例图、活动图、泳道图       |

------

### 📌 阶段二：微服务骨架搭建与基础设施接入

| 编号 | 任务内容                                        | 输出成果                        |
| ---- | ----------------------------------------------- | ------------------------------- |
| 2.1  | 搭建整体目录结构与解决方案（.sln）              | 完整项目骨架                    |
| 2.2  | 各服务初始化（仅启动 API 项目 + Swagger）       | 可运行的空项目结构              |
| 2.3  | **用户与身份服务基础模型（User + Role）搭建**   | 提供鉴权服务的数据源模型        |
| 2.4  | IdentityServer4 鉴权中心搭建（支持 JWT/OAuth2） | 统一认证服务，绑定用户模型      |
| 2.5  | API 网关配置（YARP）                            | 支持统一路由，鉴权拦截          |
| 2.6  | 集成 Serilog 日志输出 + Sink                    | 控制台 + 文件输出，日志统一格式 |
| 2.7  | 异常处理、响应结构封装 Middleware               | 全局异常中间件，规范接口响应    |
| 2.8  | Redis 通用缓存服务封装 + 注册中间层             | 可依赖注入的缓存接口            |
| 2.9  | RabbitMQ 封装生产者/消费者结构                  | 基类封装，提供发布订阅能力      |

------

### 📌 阶段三：核心业务服务开发

| 编号 | 模块                                             | 功能点                                                       |
| ---- | ------------------------------------------------ | ------------------------------------------------------------ |
| 3.1  | 身份服务 Identity（ UserModule+ IdentityModule） | 用户信息、地址管理、登录日志等+ 注册、登录、角色权限、Token 发放等 |
| 3.2  | 商品服务 Product                                 | 品牌、类目、SPU/SKU、分页、搜索、上下架                      |
| 3.3  | 库存服务 Inventory                               | 扣减库存、解锁库存、同步库存、预警机制                       |
| 3.4  | 购物车服务 Cart                                  | 添加购物车、更新数量、删除、合并登录前后购物车               |
| 3.5  | 订单服务 Order                                   | 创建订单、取消订单、订单状态变更、订单详情查询               |
| 3.6  | 支付服务 Payment                                 | 订单支付、支付回调、查询支付状态、退款逻辑处理               |

------

### 📌 阶段四：中间件通信与事件驱动整合

| 编号 | 内容                                   | 输出成果                               |
| ---- | -------------------------------------- | -------------------------------------- |
| 4.1  | 事件发布封装（DomainEvent + MQ 发送）  | MQ 发布基类、接口、 支持跨服务事件驱动 |
| 4.2  | 消费者统一结构与失败重试机制           | 消费者基类、异常重试策略封装           |
| 4.3  | 订单创建 → 库存锁定 → 支付通知流程梳理 | 时序图、流程文档                       |

------

### 📌 阶段五：后台管理端（admin）

| 编号 | 内容                                                     | 输出成果                         |
| ---- | -------------------------------------------------------- | -------------------------------- |
| 5.1  | 使用 MVC 构建后台 Web 项目                               | ECommerce.Admin.Web 项目启动成功 |
| 5.2  | 接入授权机制（Cookie + JWT混合/ OAuth2 鉴权 + 权限控制） | 权限限制策略与角色管理界面       |
| 5.3  | 商品/订单/用户管理界面                                   | 可用的管理视图与表单页面         |

### 📌 阶段六：前端开发与界面设计

| 编号 | 任务内容                              | 输出成果                                |
| ---- | ------------------------------------- | --------------------------------------- |
| 6.1  | 系统UI设计与前端技术选型（React/Vue） | UI设计稿（Figma）、选型报告             |
| 6.2  | 初始化项目结构与页面路由配置          | 前端项目基础结构与路由模块              |
| 6.3  | 用户注册、登录与权限验证页面开发      | 注册登录页面，JWT集成，登录态管理       |
| 6.4  | 商品展示、搜索与筛选功能页面开发      | 商品列表页、商品详情页、搜索栏等组件    |
| 6.5  | 购物车管理、订单确认与支付界面开发    | 购物车组件、订单提交页面、支付逻辑      |
| 6.6  | 用户中心与订单历史页面开发            | 个人信息页面、历史订单查看模块          |
| 6.7  | 与后端API联调并处理错误/加载状态      | 联调报告、API封装工具、错误处理机制完善 |
| 6.8  | 响应式布局与兼容性优化                | 移动端适配、常见浏览器兼容性处理报告    |
| 6.9  | 前端测试与代码审查                    | 单元测试用例、PR审查记录、Bug修复清单   |

### 📌 阶段七：基础设施与中间件集成

| 编号 | 内容                                 | 输出成果                              |
| ---- | ------------------------------------ | ------------------------------------- |
| 7.1  | 单元测试覆盖与集成测试编写           | 测试报告、测试覆盖率报告              |
| 7.2  | CI/CD 流水线配置（GitHub Actions）   | Dockerfile + build 流程               |
| 7.3  | 容器化部署（docker-compose 本地）    | 所有服务可用，能正常调用              |
| 7.4  | Kubernetes 配置 + Helm Chart         | 可部署至集群的 YAML 与 Helm 包        |
| 7.5  | 日志系统（Serilog → Elasticsearch）  | 结构化日志 + 可查询日志界面（Kibana） |
| 7.6  | 系统监控接入（Prometheus + Grafana） | 服务状态可视化 Dashboard              |

------

## 三、开发流程路线

### ✅ 推荐开发路径

1. **先完成：基础骨架 + 身份服务 + 网关连通**
2. **再开发：商品 → 购物车 → 订单 → 支付 → 库存**
3. **过程中并行集成：Redis、MQ、日志、认证、异常处理**
4. **最后上线前做测试、容器化、监控部署等操作**

### ✅ 推荐 DDD 项目结构

> 完整项目结构请见《1-技术方案》文档

```bash
ECommercePlatform/
├── admin/
│   └── ECommerce.Admin.Web/
│       ├── Controllers/
│       ├── Models/
│       ├── Services/
│       └── Views/

├── gateway/
│   └── ECommerce.APIGateway/
│       ├── Configs/
│       ├── Extensions/
│       └── Middlewares/

├── infrastructure/
│   ├── ECommerce.BuildingBlocks/
│   │   ├── Authentication/
│   │   ├── EventBus/
│   │   ├── Extensions/
│   │   ├── Logging/
│   │   ├── Middlewares/
│   │   └── Redis/
│   └── ECommerce.SharedKernel/
│       ├── Base/
│       ├── Constants/
│       ├── DTOs/
│       ├── Enums/
│       ├── Exceptions/
│       └── Interfaces/

├── services/
│   ├── product/
│   │   └── ECommerce.Product.API/
│   │       ├── Application/
│   │       ├── Domain/
│   │       ├── Infrastructure/
│   │       └── Interfaces/
│   ├── cart/
│   ├── order/
│   ├── payment/
│   └── inventory/
│
├── deployment/
│   ├── env/
│   └── k8s/

├── docs/

└── tests/
    └── ECommerce.Product.Tests/
```

------

## 四、技术栈汇总

| 类别       | 技术选型                                         |
| ---------- | ------------------------------------------------ |
| 前端       | Vue 3 + Pinia + Vite + Element Plus              |
| 后端框架   | ASP.NET Core Web API + MVC                       |
| 微服务网关 | YARP                                             |
| ORM        | Entity Framework Core + SQL Server               |
| 身份认证   | IdentityServer4 + JWT（支持 SSO 与 OAuth2 扩展） |
| 缓存       | Redis（支持分布式缓存）                          |
| 消息队列   | RabbitMQ（支持异步通信与事件驱动）               |
| 搜索引擎   | Elasticsearch（商品检索与日志查询）              |
| 接口文档   | Swagger / OpenAPI 3.0                            |
| 日志系统   | Serilog + Sink.File + Kibana                     |
| 配置管理   | appsettings.json / 环境变量 / Secret Manager     |
| CI/CD      | Docker + GitHub Actions + Helm                   |
| 部署       | Docker Compose（开发） / Kubernetes（生产）      |